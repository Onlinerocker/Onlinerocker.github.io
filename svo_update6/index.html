<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.25.3"/><link as="script" rel="preload" href="/webpack-runtime-1617f9f29ca113743355.js"/><link as="script" rel="preload" href="/framework-73dfc43896e80fc89ebf.js"/><link as="script" rel="preload" href="/app-6a822b5568bd459f4174.js"/><link as="script" rel="preload" href="/commons-a30d9b8c89d158d4c38c.js"/><link as="script" rel="preload" href="/component---src-pages-svo-update-6-js-6186cec2da3807c317a1.js"/><link as="fetch" rel="preload" href="/page-data\svo_update6\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data\app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"/><nav class="navbar navbar-expand navbar-dark bg-dark"><span class="navbar-brand"><img src="/leaf.png" width="42" height="30" class="d-inline-block align-top" alt=""/></span><span class="navbar-brand">Gabe Caldwell</span><div class="mr-auto navbar-nav"><div class="nav-item"><a href="/" data-rb-event-key="/" class="nav-link">Projects</a></div><div class="nav-item"><a href="/resume" data-rb-event-key="/resume" class="nav-link">Resume</a></div><div class="nav-item"><a href="/blog" data-rb-event-key="/blog" class="nav-link">Blog</a></div><div class="nav-item"><a href="/about" data-rb-event-key="/about" class="nav-link">About</a></div></div></nav><div class="container-fluid"><br/><div style="max-width:1200px" class="card"><div class="card-header" style="background:#EEEEEE">7/21/2022</div><div class="card-body"><div class="card-title h5"><h2>SVO Ray Tracer Update #6 - Sphere Add/Remove, Ray/Sphere Intersection</h2></div><a href="https://github.com/Onlinerocker/SVO">Project&#x27;s GitHub Repo</a><br/><br/><div class="card-title h5">Sphere-Voxel Intersection</div>The goal for this week was to enhance the modification system to support a spherical volume of voxels rather than just individual voxels. The simplest implementation of this is to iterate over all the voxels in the scene and see which of those are less than the radius away from the sphere’s center. At the time, my voxel data structure didn’t actually store the positions of each voxel in any way. The positions could be deduced by traversing the octree, but that would be too slow for my purposes. Instead, I created another structure to store some extra information about each voxel, including the position (I didn’t modify the current structure since it gets uploaded to the GPU via Structured Buffer). The new structure, which I refer to as position map, has one entry for each node in the octree. The index of a node in the octree and the index at which the node’s position is stored in the position map are equal, so lookups are constant time.<br/><br/><div class="card-title h5">Modifying Voxels Intersecting With the Sphere</div>After determining which voxels are inside the sphere you can flip their bit to remove/add them. Like modifying individual voxels, though, parent nodes need to be updated accordingly. If a root node becomes 0 it’s valid bit must be set to 0. This can cause a chain reaction of zeroing valid bits up the octree. Thus, we need to move up the octree and set bits accordingly. This requires us to know any given nodes parent node. In the individual voxel modification this is returned from the ray trace function. This modification scheme doesn’t ray trace each modified voxel, so this information needs to be calculated. Traversing the tree for each modified voxel and saving off each parent node is expensive. Since the parents never change, we’ll cache a parent pointer for each node in our position map. With this, it’s now possible to modify any arbitrary node and update its parents with O(logn) complexity.<br/><br/>Here&#x27;s a demo of all of this working:<br/><iframe width="560" height="315" src="https://www.youtube.com/embed/ZUEYByWn2g0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe><br/><br/><div class="card-title h5">Sphere Ray Trace</div>I also added a sphere ray trace function to my pixel shader. This will be used to render an explosion effect before deleting voxels. The ray sphere intersection is determined with the following steps:<br/><br/>⦁ Determine your ray: <br/><i>R = O + D*T</i><br/><br/>⦁ Calculate the vector connecting P and the sphere&#x27;s origin, C: <br/><i>L = C - P</i><br/><br/>⦁ Project the previous vector to your new ray:<br/><i>tca = dot(L, R)</i><br/><br/>⦁ Use this projection to calculate a new vector with your ray:<br/><i>T = O + D*tca</i><br/><br/>⦁ Calculate the vector connecting D and C:<br/><i>D = T - C</i><br/><br/>⦁ The length squared can be calculated with the dot product.<br/><i>d_squared = dot(D, D)</i><br/><br/>⦁ We can calculate thc using the Pythagorean theorem:<br/><i>thc = sqrt(radius_squared - d_squared)</i><br/><br/>⦁ We can now subtract thc from tca to get the t-value for the first intersection point, and add it for the second intersection point:<br/><i>P = O + D(tca – thc)</i><br/><i>P&#x27; = O + D(tca + thc)</i><br/><br/><img src="../ray_sphere.png" style="width:40%;max-width:900px;padding-right:19px" class=""/><br/><i>Ray sphere intersection diagram (credit: scratchapixel)</i><br/><br/></div></div></div><br/></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/svo_update6/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4c37c289014b66ab0de6.js"],"app":["/app-6a822b5568bd459f4174.js"],"component---src-pages-about-js":["/component---src-pages-about-js-50e00aef196e59bc65b5.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-9ba05165fa46dec6900c.js"],"component---src-pages-cel-shade-js":["/component---src-pages-cel-shade-js-ca85c40fd0dc961a9afb.js"],"component---src-pages-fiea-js":["/component---src-pages-fiea-js-3e5a85163a24ccbb3430.js"],"component---src-pages-index-js":["/component---src-pages-index-js-444d28301b6c2db48fbd.js"],"component---src-pages-resume-js":["/component---src-pages-resume-js-36d2464057521d54935f.js"],"component---src-pages-snow-effect-js":["/component---src-pages-snow-effect-js-3e12d86bd376e5256fa1.js"],"component---src-pages-svo-index-js":["/component---src-pages-svo-index-js-6375f014ef8fb7d7e60f.js"],"component---src-pages-svo-update-1-js":["/component---src-pages-svo-update-1-js-0723e46ca5eabec566ec.js"],"component---src-pages-svo-update-2-js":["/component---src-pages-svo-update-2-js-9974a81af8a7dfb78926.js"],"component---src-pages-svo-update-3-js":["/component---src-pages-svo-update-3-js-611c27f570b6cf21ce40.js"],"component---src-pages-svo-update-4-js":["/component---src-pages-svo-update-4-js-acb33032709bbbe4d10c.js"],"component---src-pages-svo-update-5-js":["/component---src-pages-svo-update-5-js-fcc98e07cae929786ffb.js"],"component---src-pages-svo-update-6-js":["/component---src-pages-svo-update-6-js-6186cec2da3807c317a1.js"],"component---src-pages-tree-gen-js":["/component---src-pages-tree-gen-js-6d303cddaa95e30c97f8.js"],"component---src-pages-ultrastack-js":["/component---src-pages-ultrastack-js-6e8bb6977d46934610ee.js"]};/*]]>*/</script><script src="/polyfill-4c37c289014b66ab0de6.js" nomodule=""></script><script src="/component---src-pages-svo-update-6-js-6186cec2da3807c317a1.js" async=""></script><script src="/commons-a30d9b8c89d158d4c38c.js" async=""></script><script src="/app-6a822b5568bd459f4174.js" async=""></script><script src="/framework-73dfc43896e80fc89ebf.js" async=""></script><script src="/webpack-runtime-1617f9f29ca113743355.js" async=""></script></body></html>